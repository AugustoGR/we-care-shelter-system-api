generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ShelterRole {
  OWNER
  ADMIN
  VOLUNTEER
}

model Animal {
  id        String   @id @default(cuid())
  name      String
  species   String
  breed     String?
  age       Int?
  sex       String
  health    String
  care      String?
  rabies    Boolean  @default(false)
  cinomose  Boolean  @default(false)
  parvo     Boolean  @default(false)
  felina    Boolean  @default(false)
  photo     String?
  status    String   @default("Em Cuidado")
  active    Boolean  @default(true)
  shelterId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  shelter   Shelter @relation(fields: [shelterId], references: [id], onDelete: Cascade)

  @@map("animals")
}

model ModuleVolunteer {
  id              String          @id @default(cuid())
  moduleId        String
  volunteerId     String
  createdAt       DateTime        @default(now())
  shelterModule   ShelterModule @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  volunteer       Volunteer      @relation(fields: [volunteerId], references: [id], onDelete: Cascade)

  @@unique([moduleId, volunteerId])
  @@map("module_volunteers")
}

model Resource {
  id         String    @id @default(cuid())
  nome       String
  categoria  String
  quantidade Int
  unidade    String
  validade   DateTime?
  status     String    @default("Em Estoque")
  shelterId  String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  shelter    Shelter  @relation(fields: [shelterId], references: [id], onDelete: Cascade)

  @@map("resources")
}

model ShelterModule {
  id                     String              @id @default(cuid())
  shelterId              String
  moduleKey              String
  active                 Boolean             @default(true)
  responsibleVolunteerId String?
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  associatedVolunteers   ModuleVolunteer[]
  responsibleVolunteer   Volunteer?         @relation(fields: [responsibleVolunteerId], references: [id])
  shelter                Shelter            @relation(fields: [shelterId], references: [id], onDelete: Cascade)

  @@unique([shelterId, moduleKey])
  @@map("shelter_modules")
}

model ShelteredPerson {
  id             String   @id @default(cuid())
  nome           String
  cpf            String   @unique
  dataNascimento DateTime
  genero         String
  status         String   @default("Ativo")
  active         Boolean  @default(true)
  shelterId      String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  shelter        Shelter @relation(fields: [shelterId], references: [id], onDelete: Cascade)

  @@map("sheltered_people")
}

model Shelter {
  id              String             @id @default(cuid())
  name            String
  description     String?
  calamity        String
  address         String
  city            String
  state           String
  cep             String
  active          Boolean            @default(true)
  ownerId         String
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  animals         Animal[]
  resources       Resource[]
  modules         ShelterModule[]
  shelteredPeople ShelteredPerson[]
  owner           User              @relation("ShelterOwner", fields: [ownerId], references: [id])
  volunteers      Volunteer[]
  userShelters    UserShelter[]

  @@map("shelters")
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  password     String
  name         String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  ownedShelters Shelter[]    @relation("ShelterOwner")
  volunteer    Volunteer?
  userShelters UserShelter[]

  @@map("users")
}

model UserShelter {
  id        String      @id @default(cuid())
  userId    String
  shelterId String
  role      ShelterRole @default(VOLUNTEER)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  shelter   Shelter     @relation(fields: [shelterId], references: [id], onDelete: Cascade)

  @@unique([userId, shelterId])
  @@map("user_shelters")
}

model Volunteer {
  id                     String              @id @default(cuid())
  phone                  String
  skills                 String[]            @default([])
  status                 String              @default("Ativo")
  lastActivity           DateTime            @default(now())
  shelterId              String
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  userId                 String              @unique
  associatedModules      ModuleVolunteer[]
  responsibleForModules  ShelterModule[]
  shelter                Shelter            @relation(fields: [shelterId], references: [id], onDelete: Cascade)
  user                   User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("volunteers")
}
